<%# Seenlist %>

<div class="columns is-mobile">
  
  <div class="column is-half">
      <% if current_user.seenlist_movies.include?(movie) %>
        <% if current_user.liked_movies.include?(movie) %>

          <%= button_to seenlist_path(current_user.seenlists.find { |s| s.movie == movie }.id ),
            method: :delete,
            params: { "seenlist[movie_id]" => movie.id,
                      "seenlist[user_id]" => current_user.id,
                      "seenlist[score]" => nil },
          remote: true,
          class: "button is-rounded has-opacity-75 is-small" do %>
          <span class="icon is-small is-marginless has-text-success">
            <i class="fas fa-thumbs-up"></i>
          </span>
        <% end %>

      <% elsif current_user.disliked_movies.include?(movie) %>

        <%= button_to seenlist_path(current_user.seenlists.find { |s| s.movie == movie }.id ),
          method: :delete,
          params: { "seenlist[movie_id]" => movie.id,
                    "seenlist[user_id]" => current_user.id,
                    "seenlist[score]" => nil },
          remote: true,
          class: "button is-rounded has-opacity-75 is-small" do %>
          <span class="icon is-small is-marginless has-text-danger">
            <i class="fas fa-thumbs-down"></i>
          </span>
        <% end %>

      <% end %>

    <% else %>

      <div class="columns is-multiline is-mobile has-text-centered">

        <div class="column is-12">
          <p class="is-size-6 has-text-weight-bold">My Rating</p>
        </div>

        <div class="column is-half">
          <%= button_to seenlists_path,
            method: :post,
            params: { "seenlist[movie_id]" => movie.id,
                      "seenlist[user_id]" => current_user.id,
                      "seenlist[score]" => 0 },
            remote: true,
            class: "button is-danger is-rounded is-outlined" do %>
            <span class="icon">
              <i class="fas fa-thumbs-down"></i>
            </span>
          <% end %>
        </div>

        <div class="column is-half">
          <%= button_to seenlists_path,
            method: :post,
            params: { "seenlist[movie_id]" => movie.id,
                      "seenlist[user_id]" => current_user.id,
                      "seenlist[score]" => 1 },
            remote: true,
            class: "button is-rounded is-success is-outlined" do %>
            <span class="icon" >
              <i class="fas fa-thumbs-up"></i>
            </span>
          <% end %>
        </div>

      </div>

    <% end %>
  </div>

  <%# Watchlist %>

  <div class="column is-half">
    <div class="columns is-mobile is-centered is-multiline has-text-centered">
      <div class="column is-narrow">
        <% if current_user.watchlist_movies.include?(movie) %>

          <p class="is-size-6 has-text-weight-bold field">- from Watchlist</p>

          <%= button_to watchlist_path(current_user.watchlists.find { |w| w.movie == movie }.id),
            method: :delete,
            remote: true,
            class: "button is-danger is-rounded" do %>
            <span class="icon">
              <i class="fas fa-list"></i>
            </span>
          <% end %>

        <% else %>

          <p class="is-size-6 has-text-weight-bold field">+ to Watchlist</p>
          <%= button_to watchlists_path,
            method: :post,
            params: { "watchlist[movie_id]" => movie.id,
                      "watchlist[user_id]" => current_user.id,
                      "query" => @query },
            remote: true,
            class: "button is-link is-rounded" do %>
            <span class="icon">
              <i class="fas fa-list"></i>
            </span>
          <% end %>
        <% end %>
      </div>

      <%# Nominate Buttons %>
      <div class="column is-narrow">
        <p class="is-size-6 has-text-weight-bold field">Nominate</p>
        <% unless @locked %>

          <% if current_user &&
              current_club &&
              current_club.current_poll && 
              current_user.current_nominations(current_club.current_poll).map(&:movie).map(&:id).include?(movie.id) %>

            <%= button_to nomination_path(current_user.current_nominations(current_club.current_poll).detect { |nom| nom.movie.id == movie.id}.id),
              method: :delete,
              remote: true,
              disabled: @locked,
              data: { tooltip: "Un-Nominate" },
              class: "button is-danger is-rounded" do %>
                <span class="icon">
                  <i class="fas fa-trash-restore"></i>
                </span>
            <% end %>

          <% elsif current_user &&
              current_club &&
              current_club.current_poll %>

            <%= button_to nominations_path,
              method: :post,
              params: { "nomination[poll_id]" => current_club.current_poll.id,
                        "nomination[movie_id]" => movie.id, 
                        "nomination[user_id]" => current_user.id },
              remote: true,
              disabled: @locked,
              data: { tooltip: "Nominate" },
              class: "button is-rounded" do %>
                <span class="icon">
                  <i class="fas fa-person-booth"></i>
                </span>
            <% end %>
          <% end %>
        <% end %>
      </div>
    </div>
  </div>
</div>

<hr/>
